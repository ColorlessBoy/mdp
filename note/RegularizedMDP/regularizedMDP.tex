\documentclass[a4paper]{article}

\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{tcolorbox}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}

% newtheorem
\newtheorem{assumption}{Assumption}
\newtheorem{conjecture}{Conjecture}
\newtheorem{corollary}{Corollary}
\newtheorem{claim}{Claim}
\newtheorem{example}{Example}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{remark}{Remark}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}

\title{A Theory of Regularized MDPs}
\author{Peng Lingwei}
\begin{document}

\maketitle
\tableofcontents
\newpage

\section{Regularized MDPs}%

\begin{enumerate}
    \item Regularized function: $ \Omega(\pi) $ is strongly convex;
    \item Regularized value functions: $ V^{\pi, \Omega}(s) = V^{\pi} - \Omega(\pi(s))$
        \begin{align*}
            V^{\pi, \Omega}(s) =& \mathbb{E}^{\pi}\left[ \sum^{\infty}_{t=0} \gamma^t (r(S_t, A_t) - (1-\lambda)\Omega(\pi(s))) \vert S_0 = s \right] \\
            =& \mathbb{E}^{\pi}\left[ \sum^{\infty}_{t=0} \gamma^t (r(S_t, A_t)) \vert S_0 = s \right] - \sum^{\infty}_{t=0} (1-\gamma) \Omega(\pi(s)) \\
            =& V^{\pi}(s) - \Omega(\pi(s))
        \end{align*}
        In MDP, $ Q^{\pi}(s,a) = r(s,a) + \gamma \mathbb{E}_{P(s'|s,a)}\left[ V^{\pi}(s') \right] $. And $ V^{\pi} = T^{\pi}V^{\pi} = {\left( \langle \pi(s), Q^{\pi}(s, \cdot) \rangle \right)}_{s \in S} $. 
        Then,let $ Q^{\pi, \Omega}(s,a) = r(s,a) + \gamma \mathbb{E}_{P(s'|s,a)}\left[ V^{\pi, \Omega}(s') \right] $,
        \[
            V^{\pi, \Omega}(s) = \langle \pi(s), Q^{\pi, \Omega}(s, \cdot) \rangle - (1-\gamma)\Omega(\pi(s))
        \]
    \item Regularized optimal value function: $ V^{*, \Omega}(s) = \max_{\pi \in \Pi^{MR}} V^{\pi}(s) - \Omega(\pi(s)) $
        Let $ Q^{*, \Omega}(s, \cdot) = r(s,a) + \gamma \mathbb{E}_{P(s'|s,a)}\left[ V^{*,\Omega}(s') \right] $.
        \begin{align*}
            V^{*, \Omega}(s) =& \max_{\pi \in \Pi^{MR}} V^{\pi}(s) - \Omega(\pi(s))\\
            =& \max_{\pi \in \Pi^{MR}} \langle \pi(s), Q^{\pi, \Omega}(s, \cdot) \rangle- (1 - \gamma)\Omega(\pi(s))\\
            =& \max_{\pi \in \Pi^{MR}} \langle \pi(s), Q^{*, \Omega}(s, \cdot) \rangle- (1 - \gamma)\Omega(\pi(s)) \quad (\text{proof is trivial})\\
            =& \Omega^{*}_{\gamma}(Q^{*,\Omega}(s,\cdot))
        \end{align*}
        where $ \Omega_{\gamma}^{*} $ is Legendre-Fenchel transform of $ (1-\gamma)\Omega $. More specifically,
        \[
            \forall q_s \in \mathbb{R}^{\left| A \right|}, \Omega_{\gamma}^{*}(q_s) 
            = \max_{\pi \in \Pi^{MR}} \langle \pi_s, q_s \rangle - (1- \gamma) \Omega(\pi_s)
        \]
        
    \item Regularized Bellman operator: $ T^{\pi,\Omega}V = T^{\pi} V - (1-\gamma)\Omega(\pi)$\\
        \begin{itemize}
            \item Let $ Q_V(s,a) = r(s,a) + \gamma \mathbb{E}_{P(s'|s,a)}\left[ V(s') \right] $,
                \[
                    T^{\pi,\Omega}V (s) = \langle \pi_s, Q_V(s, \cdot) \rangle - (1 - \lambda)\Omega(\pi_s)
                \]
            \item Monotonicity:$ V_1 \succeq V_2 \Rightarrow T^{\pi, \Omega}V_1 \succeq T^{\pi, \Omega}V_2 $
                \[
                    T^{\pi, \Omega}V_1 - T^{\pi, \Omega}V_2 = T^{\pi}V_1 - T^{\pi}V_2 \succeq \vec{0}
                \]
            \item Distributivity: $ T^{\pi, \Omega}(V + c \vec{1}) =  T^{\pi, \Omega}(V) + \gamma c \vec{1} $
                \begin{align*}
                    T^{\pi, \Omega}(V + c \vec{1}) =& T^{\pi}(V + c \vec{1}) - (1-\gamma)\Omega(\pi) \\
                    =& T^{\pi}(V) + \gamma c \vec{1} - (1-\gamma)\Omega(\pi) = T^{\pi \Omega}V + \gamma c \vec{1}
                \end{align*}
                \item Contraction: $ \Arrowvert T^{\pi, \Omega}V_1 - T^{\pi, \Omega}V_2 \Arrowvert_{\infty} \le \gamma {\Arrowvert V_1 - V_2 \Arrowvert}_\infty $
                    \[
                        \Arrowvert T^{\pi, \Omega}V_1 - T^{\pi, \Omega}V_2 \Arrowvert_{\infty}
                        = \Arrowvert T^{\pi}V_1 - T^{\pi}V_2 \Arrowvert_{\infty}
                        \le \gamma \Arrowvert V_1 - V_2 \Arrowvert_{\infty}
                    \]
            \item $ T^{\pi,\Omega} $'s unique fixed point is $ V^{\pi, \Omega} $;
                \begin{align*}
                    T^{\pi, \Omega}V^{\pi, \Omega} =& T^{\pi}V^{\pi, \Omega} - (1 - \gamma) \Omega(\pi)\\
                    =& T^{\pi}\left( V^{\pi} - \Omega(\pi) \right) - (1 - \gamma) \Omega(\pi)\\
                    =& T^{\pi}(V^{\pi}) - \gamma \Omega(\pi) - (1-\gamma) \Omega(\pi)\\
                    =& V^{\pi} - \Omega(\pi) = V^{\pi, \Omega}
                \end{align*}
        \end{itemize}
    \item Regularized optimal Bellman operator: $ T^{*,\Omega}V = \max_{\pi \in \Pi^{MR}} T^{\pi,\Omega}V $;
        \begin{align*}
            T^{*,\Omega}V = \max_{\pi \in \Pi^{MR}} \langle \pi_s, Q_V(s, \cdot) \rangle - (1 - \lambda)\Omega(\pi_s)
            = \Omega^{*}_{\gamma}( Q_{V}(s,\cdot))
        \end{align*}
        \begin{itemize}
            \item Monotonicity: $ V_1 \succeq V_2 \Rightarrow T^{*,\Omega} V_1 \succeq T^{*, \Omega} V_2 $.\\
                Let $ V_1 $'s optimal policy be $ \pi_1 $, and $ V_2 $'s be $ \pi_2 $.
                \begin{align*}
                    T^{*,\Omega} V_1 - T^{*, \Omega} V_2 =& \max_{\pi \in \Pi^{MR}} T^{\pi,\Omega}V_1 -  \max_{\pi \in \Pi^{MR}} T^{\pi,\Omega}V_2\\
                    \succeq& T^{\pi_2, \Omega}V_1 - T^{\pi_2, \Omega}V_2 \succeq P^{\pi_2} (V_1 - V_2) \succeq \vec{0}
                \end{align*}
            \item Distributivity: $ T^{*,\Omega}(V + c \vec{1}) = T^{*, \Omega}V + \gamma c \vec{1} $.
            \item Contraction: $ {\Arrowvert T^{*, \Omega}V_1 - T^{*, \Omega}V_2 \Arrowvert}_\infty \preceq \gamma {\Arrowvert V_1 - V_2 \Arrowvert}_\infty $
                \begin{align*}
                    {\Arrowvert T^{*, \Omega}V_1 - T^{*, \Omega}V_2 \Arrowvert}_\infty
                    \le {\Arrowvert T^{\pi_1,\Omega} V_1 - T^{\pi_1, \Omega}V_2 \Arrowvert}_\infty
                    \le {\Arrowvert T^{\pi_1} V_1 - T^{\pi_1} V_2 \Arrowvert}_\infty
                    \le \gamma {\Arrowvert V_1 - V_2 \Arrowvert}_\infty
                \end{align*}
            \item $ T^{*, \Omega} $'s unique fixed point is $ V^{*,\Omega} $. (We talk about $ \sup $ instead of $ \min $)\\
                First we proof $ V \succeq T^{*,\Omega} V \Rightarrow V \succeq V^{*,\Omega}$:
                \begin{align*}
                    &\forall \pi, \quad 
                    V \succeq \sup_{\pi' \in \Pi^{MR}} T^{\pi', \Omega} V \succeq r^\pi + \gamma P^{\pi} V - (1-\gamma) \Omega(\pi)\\
                    \Rightarrow& V \succeq {(I - \gamma P^{\pi})}(r^{\pi} - (1-\gamma)\Omega(\pi)) = V^{\pi,\Omega}
                    \quad \Rightarrow V \succeq V^{*, \Omega}
                \end{align*}
                Second we proof $ V \preceq T^{*,\Omega} V \Rightarrow V \preceq V^{*,\Omega}$:
                By definition of $ \sup $,
                \[
                    \forall \epsilon, \exists \pi \in \Pi^{MR}, V \preceq T^{\pi, \Omega}V + \epsilon \cdot \vec{1}
                    \Rightarrow V \preceq {(I - \lambda P^{\pi})}^{-1} [r^{\pi} - (1-\gamma)\Omega(\pi) + \epsilon \cdot \vec{1}] 
                \]
                \[
                    V \preceq {(I - \lambda P^{\pi})}^{-1} [r^{\pi} - (1-\gamma)\Omega(\pi)] + \frac{\epsilon}{1 - \gamma} \vec{1} \preceq V^{*, \Omega} + \frac{\epsilon}{1 - \gamma} \vec{1}
                \]
        \end{itemize}
    \item Assume that $ \Omega_L \le \Omega \le \Omega_U $, then $ V^{\pi} - \Omega_U \le V^{\pi, \Omega} \le V^{\pi} - \Omega_L $.
        \[
             \max_{\pi \in \Pi^{MR}} V^{\pi} - \Omega_U \le \max_{\pi \in \Pi^{MR}} V^{\pi, \Omega} \le \max_{\pi \in \Pi^{MR}} V^{\pi} - \Omega_L \Rightarrow V^{*} - \Omega_U \le V^{*, \Omega} \le V^{*} - \Omega_L
        \]
        Furthermore,
        \begin{align*}
            &V^{*} \le V^{*, \Omega} + \Omega_U = V^{\pi^{*, \Omega}, \Omega} + \Omega_U \le V^{\pi^{*,\Omega}} + \Omega_U - \Omega_L \\
            \Rightarrow& V^* - \left( \Omega_U - \Omega_L \right) \le V^{\pi^{*, \Omega}} \le V^{*}
        \end{align*}
\end{enumerate}

\section{Negative entropy}%

A classical example is the negative entropy $ \Omega(\pi_s) = {(1 - \gamma)}^{-1}\sum^{}_{a} \pi_s(a) \ln \pi_s(a) $.

\begin{align*}
    \Omega^{*}_{\gamma}(q_s) =& \max_{\pi \in \Pi^{MR}} \langle \pi_s, q_s \rangle - \sum^{}_{a} \pi_s(a) \ln \pi_s(a)\\
\end{align*}

We change it into 
\begin{align*}
    -\Omega^{*}_{\gamma}(q_s) =& \min_{\pi_{s} \succeq \vec{0}} \max_{\alpha \ne 0} \alpha \left(\sum^{}_{a} \pi_s(a) - 1 \right)-\langle \pi_s, q_s \rangle + \sum^{}_{a} \pi_s(a) \ln \pi_s(a)\\
    =& \max_{\alpha \ne 0} \min_{\pi_s \succeq \vec{0}} \alpha \left(\sum^{}_{a} \pi_s(a) - 1 \right)-\langle \pi_s, q_s \rangle + \sum^{}_{a} \pi_s(a) \ln \pi_s(a)\\
    \Rightarrow&  \alpha - q_s(a) + \ln \pi_{s}(a) + 1 = 0,\quad \sum^{}_{a} \pi_{s}(a) = 1 \\
    \Rightarrow& \sum^{}_{a} \exp\left\{ -1 + q_{s}(a) - \alpha \right\} = 1
    \Rightarrow \alpha + 1 = \ln \sum^{}_{a} \exp\left\{ q_s(a) \right\}\\
    \Rightarrow& \pi_s(a) = \frac{\exp \left\{q_{s}(a) \right\}}{\sum^{}_{a} \exp\left\{ q_s(a) \right\}} 
\end{align*}
\[
    \Omega^{*}_{\gamma}(q_s) = \ln \sum^{}_{a} \exp q_s(a) \Rightarrow \nabla \Omega^*_{\gamma}(q_s) = \frac{\exp\left\{ q_s(a) \right\}}{ \sum^{}_{a} \exp\left\{ q_s(a) \right\}} = \pi^*_s(a)
\]

\section{Error Bounds for Approximate Policy Iteration}%

\subsection{KEY BOUND THEOREM}%

\begin{enumerate}
    \item $ e_k = V_k - V^{\pi_k} $
    \item $ g_k = V^{\pi_{k+1}} - V^{\pi_k} $
    \item $ l_k = V^* - V^{\pi_k} $
    \item $ b_k = V_k - T^{\pi_k} V_k $
        \item $ \pi_{k+1} = \max_{\pi} T^{\pi} V_k $
\end{enumerate}
Target: bound $ l_k $.
\begin{lemma}
    \[
        l_{k+1} \preceq \gamma P^{\pi^*}l_k + \gamma \left\{  P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1}  - P^{\pi^*} {(I - \gamma P^{\pi_k})}^{-1}\right\} b_k
    \]
    \[
        l_{k+1} \preceq \gamma P^{\pi^*} l_k + \gamma \left\{ P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1} (I - \gamma P^{\pi_k}) - P^{\pi^*} \right\} e_k
    \]
    
    \begin{proof}
        \begin{align*}
            g_k =& T^{\pi_{k+1}} V^{\pi_{k+1}} - T^{\pi_{k+1}} V^{\pi_k} + T^{\pi_{k+1}} V^{\pi_k} - T^{\pi_{k+1}}V_k\\
            & + T^{\pi_{k+1}} V_k - T^{\pi_k} V_k + T^{\pi_k} V_k - T^{\pi_k} V^{\pi_k} \\
            \succeq& \gamma P^{\pi_{k+1}} (V^{\pi_{k+1}} - V^{\pi_k}) + \gamma P^{\pi_{k+1}}(V^{\pi_k} - V_k) + \gamma P^{\pi_k}(V_k - V^{\pi_k}) \\
            \succeq& - \gamma {(I - \gamma P^{\pi_{k+1}})}^{-1} (P^{\pi_{k+1}} - P^{\pi_k})e_k
        \end{align*}
        \begin{align*}
            e_k - g_k \preceq& \left[ I + \gamma {(I - \gamma P^{\pi_{k+1}})}^{-1} (P^{\pi_{k+1}} - P^{\pi_k}) \right] e_k\\
            =& {(I - \gamma P^{\pi_{k+1}})}^{-1} (I - \gamma P^{\pi_k}) e_k
        \end{align*}
        \begin{align*}
            l_{k+1} =& T^{\pi^*} V^* - T^{\pi^*} V^{\pi_k} + T^{\pi^*} V^{\pi_k} - T^{\pi^*} V_k + T^{\pi^*} V_k - T^{\pi_{k+1}}V_k \\
            &+ T^{\pi_{k+1}}V_k - T^{\pi_{k+1}}V^{\pi_k} + T^{\pi_{k+1}}V^{\pi_k} - T^{\pi_{k+1}} V^{\pi_{k+1}} \\
            \preceq& \gamma P^{\pi^*} (V^{*} - V^{\pi_k}) + \gamma P^{\pi^*}(V^{\pi_k} - V_k) + \gamma P^{\pi_{k+1}} (V_k - V^{\pi_k}) + \gamma P^{\pi_{k+1}} (V^{\pi_k} - V^{\pi_{k+1}})\\
            =& \gamma P^{\pi^*} l_k  + \gamma (P^{\pi_{k+1}} - P^{\pi^*}) e_k - \gamma P^{\pi_{k+1}} g_k\\
            \preceq& \gamma P^{\pi^*} l_k + \gamma \left\{ P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1} (I - \gamma P^{\pi_k}) - P^{\pi^*} \right\} e_k
        \end{align*}
        For $ (I - \gamma P^{\pi_k})e_k = b_k $,
        \[
            l_{k+1} \preceq \gamma P^{\pi^*}l_k + \gamma \left\{  P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1}  - P^{\pi^*} {(I - \gamma P^{\pi_k})}^{-1}\right\} b_k
        \]
    \end{proof}
\end{lemma}
\begin{theorem}
    \[
        \limsup_{k \rightarrow \infty} \Arrowvert V^* - V^{\pi_k} \Arrowvert_{\mu_0}
        \le \limsup_{k \rightarrow \infty}\gamma \mu_0 {(I - \gamma P^{\pi^*})}^{-1} \left\{  P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1} + P^{\pi^*} {(I - \gamma P^{\pi_k})}^{-1}\right\} \left| b_k \right|
    \]
    \[
        \limsup_{k \rightarrow \infty} \Arrowvert V^* - V^{\pi_k} \Arrowvert_{\mu_0}
        \le \limsup_{k \rightarrow \infty}\gamma \mu_0 {(I - \gamma P^{\pi^*})}^{-1} \left\{ P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1} (I + \gamma P^{\pi_k}) + P^{\pi^*} \right\} \left| e_k \right|
    \]
    After normalization,let
    \[
        Q_k = \frac{{(1 - \gamma)}^2}{2}  {(I - \gamma P^{\pi^*})}^{-1} \left\{  P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1} + P^{\pi^*} {(I - \gamma P^{\pi_k})}^{-1}\right\},
    \]
    and
    \[
        \tilde Q_k = \frac{{(1 - \gamma)}^{2}}{2} {(I - \gamma P^{\pi^*})}^{-1} \left\{ P^{\pi_{k+1}}{( I - \gamma P^{\pi_{k+1}})}^{-1} (I + \gamma P^{\pi_k}) + P^{\pi^*} \right\}.
    \]
    Then, write $ \mu_k = \mu_0 Q_k $ and $ \tilde \mu_k = \mu_0 \tilde Q_k $, we have
    \[
        \limsup_{k \rightarrow \infty} \Arrowvert V^* - V^{\pi_k} \Arrowvert_{\mu_0} \le \frac{2\gamma}{{(1 - \gamma)}^{2}}  \limsup_{k \rightarrow \infty} \Arrowvert V_k - T^{\pi_k } V_k \Arrowvert_{\mu_k}
    \]
    \[
        \limsup_{k \rightarrow \infty} \Arrowvert V^* - V^{\pi_k} \Arrowvert_{\mu_0} \le \frac{2 \gamma}{{(1 - \gamma)}^{2}} \limsup_{k \rightarrow \infty} \Arrowvert V_k - V^{\pi_k} \Arrowvert_{\tilde \mu_k}
    \]
\end{theorem}

\subsection{APPROXIMATE POLICY EVALUATION}%

\subsubsection{Linear Feature-based approximation}%
\begin{enumerate}
    \item Monte-Carlo simulations and regression: $ \min_{\theta} \Arrowvert \Phi \theta - V^{\pi_k}  \Arrowvert^2_{\rho_k} $;
    \item Minimal quadratic residual solution: $ \min_{\theta} \Arrowvert V_{\theta} - T^{\pi_k} V_{\theta} \Arrowvert^2_{\rho_k} $;
        \[
            A \theta = b\ with\ 
            \begin{cases}
                A = \Phi^T{(I - \gamma P^{\pi_k})}^{T} D_{\rho_k} (I - \gamma P^{\pi_k})\Phi\\
                b = \Phi^T{(I - \gamma P^{\pi_k})}^{T} D_{\rho_k} r^{\pi_k}
            \end{cases}
        \]
    \item Temporal Difference solution: $ \min_{\theta} \Arrowvert V_\theta - \Pi_{\pi_k} T^{\pi_k} V_{\theta} \Arrowvert^2_{\rho_k} $. For $ TD(0) $:
        \[
            A \theta = b\ with\ 
            \begin{cases}
                A = \Phi^T D_{\rho_k} (I - \gamma P^{\pi_k}) \Phi\\
                b = \Phi^T D_{\rho_k} r^{\pi_k}
            \end{cases}
        \]
\end{enumerate}

Because these method depends on the distribution $ \rho_k $ used in the minimization problem, which usually depends on the policy $ \pi_k $, therefore we have to consider the choice of $ \rho_k $.
\begin{itemize}
    \item Steady-state distribution $ \bar\rho_{\pi_k} $: $ \bar\rho_{\pi_k} = \bar\rho_{\pi_k} P^{\pi_k} $;
    \item Constant distribution $ \rho_0 $;
    \item  Mixed distribution $ \rho^{\lambda}_{\pi_k} = \rho_0{( I - \lambda P^{\pi_k})}^{-1}(1 - \lambda) $;
    \item Convex combination mixed distribution: $ \rho^{\delta}_{\pi_k} = (1 - \delta) \rho_0 + \delta \bar \rho_{\pi_k} $.
\end{itemize}
\begin{assumption}
    \[
        \inf_{\theta} \Arrowvert V_{\theta} - V^{\pi} \Arrowvert_{\rho_{\pi}} \le \epsilon
    \]
\end{assumption}

\subsubsection{The Quadratic Residual Soluction}%

\[
    \Arrowvert V_k - T^{\pi_{k}} V_{k} \Arrowvert_{\rho_k} = \inf_{\theta} \Arrowvert V_{\theta} - T^{\pi_k} V_{\theta} \Arrowvert_{\rho_k} = \inf_{\theta} \Arrowvert (I - \gamma P^{\pi_k})(V_{\theta} - V^{\pi_k}) \Arrowvert_{\rho_k} \le \Arrowvert I - \gamma P^{\pi_k} \Arrowvert_{\rho_k} \epsilon
\]
\[
    \Arrowvert V_k - T^{\pi_k} V_k \Arrowvert^2_{\mu_k} \le {\Arrowvert \mu_k / \rho_k \Arrowvert}_\infty \Arrowvert V_k - T^{\pi_k} V_k \Arrowvert^2_{\rho_k}
\]

So we need a new assumption.
\begin{assumption}
\[
    \forall \pi, \exists \mu,C, have\ P^{\pi}(i,j) \le C \mu(j).
\]
If $ \bar\mu(j) = 1/N $ and $ C = N $, it always satisfies. However, we are actually interested in finding a constant $ C \ll N $.
\end{assumption}

\begin{lemma}
    In preceeding section, $ \mu_k = \mu_0 Q_k $. If assumption2 exists, we have $ \mu_k \le C \mu $.
    \begin{proof}
        $ (P_1 P_2)(i,j) = \sum^{}_{k} P_1(i,k) P_2(k,j) \le C \mu(j) \sum^{}_{k} P_1(i,k) = C\mu(j) $. So $ Q_k(i,j) \le C \mu(j) \Rightarrow \mu_k(j) \le C\mu(j)$
    \end{proof}
\end{lemma}
\begin{theorem}
    Assume two assumption hold with some distribution $ \mu_0 $ and $ C $.
    \begin{itemize}
        \item $ \rho^{\lambda}_{\pi_k} = \mu_0 {(I - \lambda P^{\pi_k})}^{-1}(1-\lambda) $, then
            \[
               \limsup {\Arrowvert V^* - V^{\pi_k} \Arrowvert}_\infty \le \frac{2\gamma}{{(1 - \gamma)}^{2}} \sqrt{\frac{C}{1 - \lambda} } \left( 1 + \gamma\sqrt{\min\left( \frac{C}{1 - \lambda} , \frac{1}{\lambda}  \right)} \right) \epsilon  
            \]
        \item $ \rho^{\delta}_{\pi_k} = (1 - \delta) \mu_0 + \delta \bar\rho_{\pi_k} $.
            \[
                \limsup {\Arrowvert V^* - V^{\pi_k} \Arrowvert}_\infty \le \frac{2\gamma}{{(1 - \gamma)}^{2}} \sqrt{\frac{C}{1 - \delta} }(1 + \gamma \sqrt C) \epsilon
            \]
    \end{itemize}
    \begin{proof}
        \begin{enumerate}
            \item $ \rho^{\lambda}_{k} \succeq (1 - \lambda)\mu_0 $ and $ \rho^{\delta}_{k} \ge (1 - \delta) \mu_0 $.
            \item $ \Arrowvert P^{\pi_k} \Arrowvert^{2}_{\rho^\lambda_k} \le \min\left( \frac{C}{1 - \lambda}, \frac{1}{\lambda}  \right) $:
                \[
                    \Arrowvert P^{\pi_k} h \Arrowvert^2_{\rho^{\lambda}_{k}} = \rho^{\lambda}_{k} {(P^{\pi_k} h)}^{2} \le \rho^{\lambda}_{k} P^{\pi_k}h^2 \le C \mu_0 h^2 \le \frac{C}{1 - \lambda} \rho^{\lambda}_{k}h^2 = \frac{C}{1 - \lambda} \Arrowvert h \Arrowvert^2_{\rho^{\lambda}_{k}}
                \]
                \begin{align*}
                    \Arrowvert P^{\pi_k} h \Arrowvert^2_{\rho^{\lambda}_{k}}
                    =& (1 - \lambda) \mu_0 \sum^{\infty}_{t=0} \lambda^t {(P^{\pi_k})}^{t} {{P^{\pi_k}h}}^{2}
                    \le (1 - \lambda) \mu_0 \sum^{\infty}_{t=0} \lambda^{t} {(P^{\pi_k})}^{t+1} h^2\\
                    =& \frac{1 - \lambda}{\lambda} \mu_0 \left\{ \sum^{\infty}_{t=0} \lambda^t {(P^{\pi_k})}^{t} h^2 - h^2 \right\} \le \frac{1}{\lambda} \rho^{\lambda}_{k}h^2 = \frac{1}{\lambda} \Arrowvert h \Arrowvert^2_{\rho^\lambda_{k}}
                \end{align*}
            \item $ \Arrowvert P^{\pi_k} \Arrowvert^2_{\rho^{\delta}_k} \le C $.
                \begin{align*}
                    \Arrowvert P^{\pi_k} h \Arrowvert^2_{\rho^{\delta}_k}
                    =& \rho^{\delta}_{k} {(P^{\pi_k h})}^2
                    \le (1 - \delta) \mu_0 P^{\pi_k} h^2 + \delta \bar\rho_{\pi_k} P^{\pi_k}h^2
                    \le C(1 - \delta) \mu_0 h^2 + \delta \bar\rho_k h^2\\
                    =& C (\rho^{\delta} _ k - \delta \bar \rho_k) h^2 + \delta \bar\rho_k h^2
                    \le C \rho^{\delta}_{k}h^2
                \end{align*}
            \item 
                \begin{align*}
                    \limsup_{k \rightarrow\infty} \Arrowvert l_k \Arrowvert_{\mu_0}
                    \le& \frac{2\gamma}{{(1 - \gamma)}^{2}} \limsup_{k \rightarrow\infty} \sqrt {{\Arrowvert \mu_k / \rho_k \Arrowvert}_\infty} \Arrowvert I - \gamma P^{\pi_k} \Arrowvert_{\rho_{\pi_k}}\epsilon\\
                    \le&  \frac{2\gamma}{{(1 - \gamma)}^{2}} \limsup_{k \rightarrow\infty} \sqrt {{\Arrowvert \mu_k / \rho_k \Arrowvert}_\infty} \left( 1 + \gamma \Arrowvert P^{\pi} \Arrowvert_{\rho_{\pi_k}} \right)\epsilon\\
                \end{align*}
        \end{enumerate}
    \end{proof}
\end{theorem} 
\subsubsection{Temporal Difference Solution}%
\begin{enumerate}
    \item 
        \begin{align*}
            &(I - \gamma \Pi_{\pi_k} P^{\pi_k}) (V_k - V^{\pi_k}) = V_k - \gamma \Pi_{\pi_k}P^{\pi_k}V_k - V^{\pi_k} + \gamma\Pi_{\pi_k}P^{\pi_k} V^{\pi_k} \\
            =& - V^{\pi_k} + \Pi_{\pi_k}(r^{\pi_k} + \gamma P^{\pi_k} V^{\pi_k}) = \Pi_{\pi_k}V^{\pi_k} - V^{\pi_k}
            := \epsilon'_k
        \end{align*}
\end{enumerate}
I lose my patience again.

\section{Finite-Time Bounds for Fitted Value Iteration}%

\subsection{Approximating the Bellman Operator}%

\begin{enumerate}
    \item Monte-Carlo estimate of $ TV_k $:
        \[
             \hat V(s) = \max_{a \in A} \frac{1}{M} \sum^{M}_{j=1} \left[ R_j(s, a) + \gamma V_k(s'_j) \right], s = 1, 2, \ldots, N
        \]
        \[
            V_{k+1} = \arg\min_{f \in \mathcal{F}} \Arrowvert f - \hat V \Arrowvert_p
        \]
    \item 
        \begin{align*}
            \mathbb{E}\left[ \hat V(s) \right] =& \mathbb{E}\left[ \max_{a \in A} \frac{1}{M} \sum^{M}_{j=1} \left[ R_j(s, a) + \gamma V_k(s'_j) \right] \right] \\
            \ge& \max_{a \in A} \mathbb{E} \left[ \frac{1}{M} \sum^{M}_{j=1} \left[ R_j(s,a) + \gamma V_k(s'_j) \right] \right] = TV_k
        \end{align*}
    \item Bound $ \mathbb{P} \left\{ {\Arrowvert \hat V - T^{\pi_k}V_k \Arrowvert}_\infty \ge \epsilon\right\} \le \delta $
        \begin{proof}
            \begin{align*}
                \mathbb{P} \left\{ {\Arrowvert V^{\pi_k} - T^{\pi_k}V_k \Arrowvert}_\infty \ge \epsilon \right\}
                \le 2 e^{-\frac{2M \epsilon^2}{{(R_{\max} + \gamma V_{\max})}^2} }
            \end{align*}
            It's easy to find function $ M \ge C_M(\epsilon, \delta) $, which guarantees
            \[
                 \mathbb{P} \left\{ {\Arrowvert V^{\pi_k} - T^{\pi_k}V_k \Arrowvert}_\infty \ge \epsilon \right\} \le \delta
            \]
        \end{proof}
\end{enumerate}


\section{Regularized Modified Policy Iteration}%
Wait

\end{document}
